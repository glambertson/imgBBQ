(function(e,t,n,r){function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="imgBBQ",s={pathToRetina:"@2x",pathToMobile:"@Mobile",minimumKbps:200,testImgURI:"http://inspiredroots.com/__devlab/2014/imgbbq/img/speed-test.jpg",debuggingOn:!1,isRetina:t.devicePixelRatio>1,speedKbps:0,imgType:""};App={DLog:function(n){t.console&&console.log(n);typeof n=="string"&&(e(".imgbbq-output").length==0?e("body").prepend('<div class="imgbbq-output">'+n+"</div>"):e(".imgbbq-output").append('<div class="imgbbq-output">'+n+"</div>"))},UrlExists:function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);t.send();return t.status!=404}};isMobile={Android:function(){return navigator.userAgent.match(/Android/i)?!0:!1},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)?!0:!1},iOS:function(){return navigator.userAgent.match(/iPhone|iPod/i)?!0:!1},Windows:function(){return navigator.userAgent.match(/IEMobile/i)?!0:!1},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows()}};o.prototype={init:function(){this.consoleOutput(this.element,this.options)},consoleOutput:function(t,n){ThisElement=e(t);var r=ThisElement.attr("src"),i=r.split("/"),s=parseInt(i.length-1),o=i[s];i[s]=n.imgType+o;var u=i.join("/"),a=u;n.debuggingOn;a!=r&&App.UrlExists(a)&&ThisElement.attr("src",a)}};e.fn[i]=function(t){var n=this;p_options=e.extend({},s,t);speedTest={getConnectionSpeed:function(e){var t,n,r=1e4,i=new Image;i.onload=function(){n=(new Date).getTime();speedTest.showResults(t,n,r,e)};t=(new Date).getTime();i.src=e.testImgURI+"?r="+Math.random()},showResults:function(t,r,u,a){var f=(r-t)/1e3,l=u*8,c=(l/f).toFixed(2),h=(c/1024).toFixed(2),p=(h/1024).toFixed(2);h=parseInt(h);s.speedKbps=h;if(h>=parseInt(a.minimumKbps))if(a.isRetina)if(isMobile.any()){a.debuggingOn&&App.DLog("Good load time...Mobile...Retina...");a.imgType=null}else{a.debuggingOn&&App.DLog("Good load time...Not Mobile...Retina...");a.imgType=a.pathToRetina+"/"}else if(isMobile.any()){a.debuggingOn&&App.DLog("Good load time...Mobile...Not Retina...");a.imgType=a.pathToMobile+"/"}else{a.debuggingOn&&App.DLog("Good load time...Not Mobile...Not Retina...");a.imgType=null}if(h<parseInt(a.minimumKbps)&&h>parseInt(a.minimumKbps)*.5)if(a.isRetina)if(isMobile.any()){a.debuggingOn&&App.DLog("Slow load time...Mobile...Retina...");a.imgType=a.pathToMobile+"/"}else{a.debuggingOn&&App.DLog("Slow load time...Not Mobile...Retina...");a.imgType=null}else if(isMobile.any()){a.debuggingOn&&App.DLog("Slow load time...Mobile...Not Retina...");a.imgType=a.pathToMobile+"/"}else{a.debuggingOn&&App.DLog("Slow load time...Not Mobile...Not Retina...");a.imgType=null}if(h<=parseInt(a.minimumKbps)*.5)if(isMobile.any()){a.debuggingOn&&App.DLog("Super slow connection. Load low-fi images on Mobile.");a.imgType=a.pathToMobile+"/"}else{a.debuggingOn&&App.DLog("Super slow connection. Don't do anything.");a.imgType=null}if(a.imgType!==null){a.debuggingOn&&App.DLog("Updating images from "+a.imgType+" directory.");return n.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,a))})}a.debuggingOn&&App.DLog("Original images best suited for this scenario. Images not updated.")}};speedTest.getConnectionSpeed(p_options)}})(jQuery,window,document);